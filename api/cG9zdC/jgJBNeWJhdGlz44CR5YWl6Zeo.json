{"title":"【Mybatis】入门","date":"2019-09-10T01:26:10.000Z","thumbnail":null,"link":"post/【Mybatis】入门","tags":["Mybatis"],"categories":["奇客工具"],"updated":"2019-09-10T01:27:56.754Z","content":"<p>原始JDBC操作弊端：</p>\n<ul>\n<li>数据库连接创建、释放频繁造成系统资源浪费从而影响系统性能</li>\n<li>sql 语句在代码中硬编码，造成代码不易维护，实际应用 sql 变化的可能较大，sql 变动需要改变java代码。</li>\n<li>查询操作时，需要手动将结果集中的数据手动封装到实体中。插入操作时，需要手动将实体的数据设置到sql语句的占位符位置</li>\n</ul>\n<a id=\"more\"></a>\n\n<h3 id=\"1-Mybatis简介\">1.Mybatis简介<a href=\"post/【Mybatis】入门#1-Mybatis简介\"></a></h3><h4 id=\"1-1原始jdbc操作（查询数据）\">1.1原始jdbc操作（查询数据）<a href=\"post/【Mybatis】入门#1-1原始jdbc操作（查询数据）\"></a></h4><p><img src=\"https://i.loli.net/2019/09/04/dGlZM4RTNUOg1u2.png\" alt class=\"article-img\"></p>\n<h4 id=\"1-2原始jdbc操作（插入数据）\">1.2原始jdbc操作（插入数据）<a href=\"post/【Mybatis】入门#1-2原始jdbc操作（插入数据）\"></a></h4><p><img src=\"https://i.loli.net/2019/09/04/XtkrimKvyGQYJ3U.png\" alt class=\"article-img\"></p>\n<h4 id=\"1-3-原始jdbc操作的分析\">1.3 原始jdbc操作的分析<a href=\"post/【Mybatis】入门#1-3-原始jdbc操作的分析\"></a></h4><p>原始jdbc开发存在的问题如下：</p>\n<p>①数据库连接创建、释放频繁造成系统资源浪费从而影响系统性能</p>\n<p>②sql 语句在代码中硬编码，造成代码不易维护，实际应用 sql 变化的可能较大，sql 变动需要改变java代码。</p>\n<p>③查询操作时，需要手动将结果集中的数据手动封装到实体中。插入操作时，需要手动将实体的数据设置到sql语句的占位符位置</p>\n<p>应对上述问题给出的解决方案：</p>\n<p>①使用数据库连接池初始化连接资源</p>\n<p>②将sql语句抽取到xml配置文件中</p>\n<p>③使用反射、内省等底层技术，自动将实体与表进行属性与字段的自动映射</p>\n<h4 id=\"1-4-什么是Mybatis\">1.4 什么是Mybatis<a href=\"post/【Mybatis】入门#1-4-什么是Mybatis\"></a></h4><p>mybatis 是一个优秀的基于java的持久层框架，它内部封装了jdbc，使开发者只需要关注sql语句本身，而不需要花费精力去处理加载驱动、创建连接、创建statement等繁杂的过程。</p>\n<p>mybatis通过xml或注解的方式将要执行的各种 statement配置起来，并通过java对象和statement中sql的动态参数进行映射生成最终执行的sql语句。</p>\n<p>最后mybatis框架执行sql并将结果映射为java对象并返回。采用ORM思想解决了实体和数据库映射的问题，对jdbc 进行了封装，屏蔽了jdbc api 底层访问细节，使我们不用与jdbc api 打交道，就可以完成对数据库的持久化操作。</p>\n<h3 id=\"2-Mybatis的快速入门\">2.Mybatis的快速入门<a href=\"post/【Mybatis】入门#2-Mybatis的快速入门\"></a></h3><h4 id=\"2-1-MyBatis开发步骤\">2.1 MyBatis开发步骤<a href=\"post/【Mybatis】入门#2-1-MyBatis开发步骤\"></a></h4><p>MyBatis官网地址：<a href=\"http://www.mybatis.org/mybatis-3/\" target=\"_blank\" rel=\"noopener\">http://www.mybatis.org/mybatis-3/</a> </p>\n<p><img src=\"https://i.loli.net/2019/09/04/MNSVJcDL9uexUTE.png\" alt class=\"article-img\"></p>\n<p><strong>MyBatis开发步骤：</strong></p>\n<p>①添加MyBatis的坐标</p>\n<p>②创建user数据表</p>\n<p>③编写User实体类 </p>\n<p>④编写映射文件UserMapper.xml</p>\n<p>⑤编写核心文件SqlMapConfig.xml</p>\n<p>⑥编写测试类</p>\n<h4 id=\"2-2-环境搭建\">2.2 环境搭建<a href=\"post/【Mybatis】入门#2-2-环境搭建\"></a></h4><p>1)导入MyBatis的坐标和其他相关坐标</p>\n<figure class=\"highlight xml\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--mybatis坐标--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.4.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--mysql驱动坐标--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span>    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span>   </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span>    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.1.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span>    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--单元测试坐标--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span>    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span>    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span>    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span>    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--日志坐标--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span>    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span>    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span>    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n\n<p>2)  创建user数据表</p>\n<p><img src=\"https://i.loli.net/2019/09/04/QudSO8CtD6hGUHr.png\" alt class=\"article-img\"></p>\n<p>3) 编写User实体</p>\n<figure class=\"highlight java\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> </span>&#123;    </span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">int</span> id;    </span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String username;    </span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String password;</span><br><span class=\"line\">    <span class=\"comment\">//省略get个set方法</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<p>4)编写UserMapper映射文件</p>\n<figure class=\"highlight xml\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE mapper        </span></span><br><span class=\"line\"><span class=\"meta\">\tPUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"        </span></span><br><span class=\"line\"><span class=\"meta\">\t\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"userMapper\"</span>&gt;</span>    </span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findAll\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"com.itheima.domain.User\"</span>&gt;</span>        </span><br><span class=\"line\">\t\tselect * from User    </span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n\n<p>5) 编写MyBatis核心文件</p>\n<figure class=\"highlight xml\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE configuration PUBLIC \"-//mybatis.org//DTD Config 3.0//EN“ \"http://mybatis.org/dtd/mybatis-3-config.dtd\"&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span>    </span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">environments</span> <span class=\"attr\">default</span>=<span class=\"string\">\"development\"</span>&gt;</span>        </span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">environment</span> <span class=\"attr\">id</span>=<span class=\"string\">\"development\"</span>&gt;</span>            </span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">transactionManager</span> <span class=\"attr\">type</span>=<span class=\"string\">\"JDBC\"</span>/&gt;</span>            </span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dataSource</span> <span class=\"attr\">type</span>=<span class=\"string\">\"POOLED\"</span>&gt;</span>                </span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driver\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span>/&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql:///test\"</span>/&gt;</span>                </span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span>/&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span>/&gt;</span>            </span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dataSource</span>&gt;</span>        </span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">environment</span>&gt;</span>    </span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">environments</span>&gt;</span>    </span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">mappers</span>&gt;</span> </span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"com/itheima/mapper/UserMapper.xml\"</span>/&gt;</span> </span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">mappers</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n\n<h4 id=\"2-3-编写测试代码\">2.3 编写测试代码<a href=\"post/【Mybatis】入门#2-3-编写测试代码\"></a></h4><figure class=\"highlight java\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//加载核心配置文件</span></span><br><span class=\"line\">InputStream resourceAsStream = Resources.getResourceAsStream(<span class=\"string\">\"SqlMapConfig.xml\"</span>);</span><br><span class=\"line\"><span class=\"comment\">//获得sqlSession工厂对象</span></span><br><span class=\"line\">SqlSessionFactory sqlSessionFactory = <span class=\"keyword\">new</span>            </span><br><span class=\"line\">                           SqlSessionFactoryBuilder().build(resourceAsStream);</span><br><span class=\"line\"><span class=\"comment\">//获得sqlSession对象</span></span><br><span class=\"line\">SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class=\"line\"><span class=\"comment\">//执行sql语句</span></span><br><span class=\"line\">List&lt;User&gt; userList = sqlSession.selectList(<span class=\"string\">\"userMapper.findAll\"</span>);</span><br><span class=\"line\"><span class=\"comment\">//打印结果</span></span><br><span class=\"line\">System.out.println(userList);</span><br><span class=\"line\"><span class=\"comment\">//释放资源</span></span><br><span class=\"line\">sqlSession.close();</span><br></pre></td></tr></table></div></figure>\n\n<h4 id=\"2-4-知识小结\">2.4 知识小结<a href=\"post/【Mybatis】入门#2-4-知识小结\"></a></h4><p><strong>MyBatis开发步骤：</strong></p>\n<p>①添加MyBatis的坐标</p>\n<p>②创建user数据表</p>\n<p>③编写User实体类 </p>\n<p>④编写映射文件UserMapper.xml</p>\n<p>⑤编写核心文件SqlMapConfig.xml</p>\n<p>⑥编写测试类</p>\n<h3 id=\"3-MyBatis的映射文件概述\">3. MyBatis的映射文件概述<a href=\"post/【Mybatis】入门#3-MyBatis的映射文件概述\"></a></h3><p><img src=\"https://i.loli.net/2019/09/04/dHW4L7T6QCiJgyr.png\" alt class=\"article-img\"></p>\n<h3 id=\"4-MyBatis的增删改查操作\">4. MyBatis的增删改查操作<a href=\"post/【Mybatis】入门#4-MyBatis的增删改查操作\"></a></h3><h4 id=\"4-1-MyBatis的插入数据操作\">4.1 MyBatis的插入数据操作<a href=\"post/【Mybatis】入门#4-1-MyBatis的插入数据操作\"></a></h4><p><strong>1)编写UserMapper映射文件</strong></p>\n<figure class=\"highlight xml\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"userMapper\"</span>&gt;</span>    </span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">insert</span> <span class=\"attr\">id</span>=<span class=\"string\">\"add\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"com.itheima.domain.User\"</span>&gt;</span>        </span><br><span class=\"line\">\t\tinsert into user values(#&#123;id&#125;,#&#123;username&#125;,#&#123;password&#125;)    </span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n\n<p><strong>2)编写插入实体User的代码</strong></p>\n<figure class=\"highlight java\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">InputStream resourceAsStream = Resources.getResourceAsStream(<span class=\"string\">\"SqlMapConfig.xml\"</span>);</span><br><span class=\"line\">SqlSessionFactory sqlSessionFactory = <span class=\"keyword\">new</span> </span><br><span class=\"line\">                        SqlSessionFactoryBuilder().build(resourceAsStream);</span><br><span class=\"line\">SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class=\"line\"><span class=\"keyword\">int</span> insert = sqlSession.insert(<span class=\"string\">\"userMapper.add\"</span>, user);</span><br><span class=\"line\">System.out.println(insert);</span><br><span class=\"line\"><span class=\"comment\">//提交事务</span></span><br><span class=\"line\">sqlSession.commit();</span><br><span class=\"line\">sqlSession.close();</span><br></pre></td></tr></table></div></figure>\n\n<p><strong>3)插入操作注意问题</strong></p>\n<p>• 插入语句使用insert标签</p>\n<p>• 在映射文件中使用parameterType属性指定要插入的数据类型</p>\n<p>•Sql语句中使用#{实体属性名}方式引用实体中的属性值</p>\n<p>•插入操作使用的API是sqlSession.insert(“命名空间.id”,实体对象);</p>\n<p>•插入操作涉及数据库数据变化，所以要使用sqlSession对象显示的提交事务，即sqlSession.commit() </p>\n<h4 id=\"4-2-MyBatis的修改数据操作\">4.2 MyBatis的修改数据操作<a href=\"post/【Mybatis】入门#4-2-MyBatis的修改数据操作\"></a></h4><p><strong>1)编写UserMapper映射文件</strong></p>\n<figure class=\"highlight xml\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"userMapper\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">update</span> <span class=\"attr\">id</span>=<span class=\"string\">\"update\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"com.itheima.domain.User\"</span>&gt;</span></span><br><span class=\"line\">        update user set username=#&#123;username&#125;,password=#&#123;password&#125; where id=#&#123;id&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">update</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n\n<p><strong>2)编写修改实体User的代码</strong></p>\n<figure class=\"highlight java\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">InputStream resourceAsStream = Resources.getResourceAsStream(<span class=\"string\">\"SqlMapConfig.xml\"</span>);</span><br><span class=\"line\">SqlSessionFactory sqlSessionFactory = <span class=\"keyword\">new</span> SqlSessionFactoryBuilder().build(resourceAsStream);</span><br><span class=\"line\">SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class=\"line\"><span class=\"keyword\">int</span> update = sqlSession.update(<span class=\"string\">\"userMapper.update\"</span>, user);</span><br><span class=\"line\">System.out.println(update);</span><br><span class=\"line\">sqlSession.commit();</span><br><span class=\"line\">sqlSession.close();</span><br></pre></td></tr></table></div></figure>\n\n<p><strong>3)修改操作注意问题</strong></p>\n<p>• 修改语句使用update标签</p>\n<p>• 修改操作使用的API是sqlSession.update(“命名空间.id”,实体对象);</p>\n<h4 id=\"4-3-MyBatis的删除数据操作\">4.3 MyBatis的删除数据操作<a href=\"post/【Mybatis】入门#4-3-MyBatis的删除数据操作\"></a></h4><p><strong>1)编写UserMapper映射文件</strong></p>\n<figure class=\"highlight xml\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"userMapper\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">delete</span> <span class=\"attr\">id</span>=<span class=\"string\">\"delete\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"java.lang.Integer\"</span>&gt;</span></span><br><span class=\"line\">        delete from user where id=#&#123;id&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">delete</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n\n<p><strong>2)编写删除数据的代码</strong></p>\n<figure class=\"highlight java\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">InputStream resourceAsStream = Resources.getResourceAsStream(<span class=\"string\">\"SqlMapConfig.xml\"</span>);</span><br><span class=\"line\">SqlSessionFactory sqlSessionFactory = <span class=\"keyword\">new</span> SqlSessionFactoryBuilder().build(resourceAsStream);</span><br><span class=\"line\">SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class=\"line\"><span class=\"keyword\">int</span> delete = sqlSession.delete(<span class=\"string\">\"userMapper.delete\"</span>,<span class=\"number\">3</span>);</span><br><span class=\"line\">System.out.println(delete);</span><br><span class=\"line\">sqlSession.commit();</span><br><span class=\"line\">sqlSession.close();</span><br></pre></td></tr></table></div></figure>\n\n<p><strong>3)删除操作注意问题</strong></p>\n<p>• 删除语句使用delete标签</p>\n<p>•Sql语句中使用#{任意字符串}方式引用传递的单个参数</p>\n<p>•删除操作使用的API是sqlSession.delete(“命名空间.id”,Object);</p>\n<h4 id=\"4-4-知识小结\">4.4 知识小结<a href=\"post/【Mybatis】入门#4-4-知识小结\"></a></h4><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">增删改查映射配置与API：</span><br><span class=\"line\">查询数据： List&lt;User&gt; userList = sqlSession.selectList(<span class=\"string\">\"userMapper.findAll\"</span>);</span><br><span class=\"line\">    &lt;select id=<span class=\"string\">\"findAll\"</span> resultType=<span class=\"string\">\"com.itheima.domain.User\"</span>&gt;</span><br><span class=\"line\">        select * from User</span><br><span class=\"line\">    &lt;/select&gt;</span><br><span class=\"line\">添加数据： sqlSession.insert(<span class=\"string\">\"userMapper.add\"</span>, user);</span><br><span class=\"line\">    &lt;insert id=<span class=\"string\">\"add\"</span> parameterType=<span class=\"string\">\"com.itheima.domain.User\"</span>&gt;</span><br><span class=\"line\">        <span class=\"function\">insert into user <span class=\"title\">values</span><span class=\"params\">(#&#123;id&#125;,#&#123;username&#125;,#&#123;password&#125;)</span></span></span><br><span class=\"line\"><span class=\"function\">    &lt;/insert&gt;</span></span><br><span class=\"line\"><span class=\"function\">修改数据： sqlSession.<span class=\"title\">update</span><span class=\"params\">(<span class=\"string\">\"userMapper.update\"</span>, user)</span></span>;</span><br><span class=\"line\">    &lt;update id=<span class=\"string\">\"update\"</span> parameterType=<span class=\"string\">\"com.itheima.domain.User\"</span>&gt;</span><br><span class=\"line\">        update user set username=#&#123;username&#125;,password=#&#123;password&#125; where id=#&#123;id&#125;</span><br><span class=\"line\">    &lt;/update&gt;</span><br><span class=\"line\">删除数据：sqlSession.delete(<span class=\"string\">\"userMapper.delete\"</span>,<span class=\"number\">3</span>);</span><br><span class=\"line\">    &lt;delete id=<span class=\"string\">\"delete\"</span> parameterType=<span class=\"string\">\"java.lang.Integer\"</span>&gt;</span><br><span class=\"line\">        delete from user where id=#&#123;id&#125;</span><br><span class=\"line\">    &lt;/delete&gt;</span><br></pre></td></tr></table></div></figure>\n\n<h3 id=\"5-MyBatis核心配置文件概述\">5. MyBatis核心配置文件概述<a href=\"post/【Mybatis】入门#5-MyBatis核心配置文件概述\"></a></h3><h4 id=\"5-1-MyBatis核心配置文件层级关系\">5.1 MyBatis核心配置文件层级关系<a href=\"post/【Mybatis】入门#5-1-MyBatis核心配置文件层级关系\"></a></h4><p><img src=\"https://i.loli.net/2019/09/04/E6e5uq72GgCdsHT.png\" alt class=\"article-img\"></p>\n<h4 id=\"5-2-MyBatis常用配置解析\">5.2 MyBatis常用配置解析<a href=\"post/【Mybatis】入门#5-2-MyBatis常用配置解析\"></a></h4><p><strong>1)environments标签</strong></p>\n<p>数据库环境的配置，支持多环境配置</p>\n<p><img src=\"https://i.loli.net/2019/09/04/cC9GKJD3wEZQBmH.png\" alt class=\"article-img\"></p>\n<p>其中，事务管理器（transactionManager）类型有两种：</p>\n<p>•JDBC：这个配置就是直接使用了JDBC 的提交和回滚设置，它依赖于从数据源得到的连接来管理事务作用域。</p>\n<p>•MANAGED：这个配置几乎没做什么。它从来不提交或回滚一个连接，而是让容器来管理事务的整个生命周期（比如 JEE 应用服务器的上下文）。 默认情况下它会关闭连接，然而一些容器并不希望这样，因此需要将 closeConnection 属性设置为 false 来阻止它默认的关闭行为。</p>\n<p>其中，数据源（dataSource）类型有三种：</p>\n<p>•UNPOOLED：这个数据源的实现只是每次被请求时打开和关闭连接。</p>\n<p>•POOLED：这种数据源的实现利用“池”的概念将 JDBC 连接对象组织起来。</p>\n<p>•JNDI：这个数据源的实现是为了能在如 EJB 或应用服务器这类容器中使用，容器可以集中或在外部配置数据源，然后放置一个 JNDI 上下文的引用。</p>\n<p><strong>2)mapper标签</strong></p>\n<p>该标签的作用是加载映射的，加载方式有如下几种：</p>\n<p>•使用相对于类路径的资源引用，例如：</p>\n<mapper resource=\"org/mybatis/builder/AuthorMapper.xml\">\n\n<p>•使用完全限定资源定位符（URL），例如：</p>\n<mapper url=\"file:///var/mappers/AuthorMapper.xml\">\n\n<p>•使用映射器接口实现类的完全限定类名，例如：</p>\n<mapper class=\"org.mybatis.builder.AuthorMapper\">\n\n<p>•将包内的映射器接口实现全部注册为映射器，例如：</p>\n<package name=\"org.mybatis.builder\">\n\n<p><strong>3)Properties标签</strong></p>\n<p>实际开发中，习惯将数据源的配置信息单独抽取成一个properties文件，该标签可以加载额外配置的properties文件</p>\n<p>  <img src=\"https://i.loli.net/2019/09/04/aEgZp1AbxqhBQ8m.png\" alt class=\"article-img\"></p>\n<p><strong>4)typeAliases标签</strong></p>\n<p>类型别名是为Java 类型设置一个短的名字。原来的类型名称配置如下</p>\n<p><img src=\"https://i.loli.net/2019/09/04/vwfWnPLXrKIFO51.png\" alt class=\"article-img\"></p>\n<p>配置typeAliases，为com.itheima.domain.User定义别名为user</p>\n<p><img src=\"https://i.loli.net/2019/09/04/in2gAJdQ9lVKDCq.png\" alt class=\"article-img\"></p>\n<p>上面我们是自定义的别名，mybatis框架已经为我们设置好的一些常用的类型的别名</p>\n<p><img src=\"https://i.loli.net/2019/09/04/ZObPmoLpfFVTxYa.png\" alt class=\"article-img\"></p>\n<h4 id=\"5-3-知识小结\"><a href=\"#5-3-知识小结\" class=\"headerlink\" title=\"5.3 知识小结\"></a>5.3 知识小结</h4><p><strong>核心配置文件常用配置：</strong></p>\n<p>properties标签：该标签可以加载外部的properties文件</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">properties</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"jdbc.properties\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>typeAliases标签：设置类型别名</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">typeAlias</span> <span class=\"attr\">type</span>=<span class=\"string\">\"com.itheima.domain.User\"</span> <span class=\"attr\">alias</span>=<span class=\"string\">\"user\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">typeAlias</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>mappers标签：加载映射配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"com/itheima/mapper/UserMapping.xml\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>environments标签：数据源环境配置标签</p>\n<p><img src=\"https://i.loli.net/2019/09/04/mts7whkr8lH6z5B.png\" alt class=\"article-img\"></p>\n<h3 id=\"6-MyBatis相应API\"><a href=\"#6-MyBatis相应API\" class=\"headerlink\" title=\"6.MyBatis相应API\"></a>6.MyBatis相应API</h3><h4 id=\"6-1-SqlSession工厂构建器SqlSessionFactoryBuilder\"><a href=\"#6-1-SqlSession工厂构建器SqlSessionFactoryBuilder\" class=\"headerlink\" title=\"6.1 SqlSession工厂构建器SqlSessionFactoryBuilder\"></a>6.1 SqlSession工厂构建器SqlSessionFactoryBuilder</h4><p>常用API：SqlSessionFactory  build(InputStream inputStream)</p>\n<p>通过加载mybatis的核心文件的输入流的形式构建一个SqlSessionFactory对象</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">String resource = <span class=\"string\">\"org/mybatis/builder/mybatis-config.xml\"</span>; </span><br><span class=\"line\">InputStream inputStream = Resources.getResourceAsStream(resource); </span><br><span class=\"line\">SqlSessionFactoryBuilder builder = <span class=\"keyword\">new</span> SqlSessionFactoryBuilder(); </span><br><span class=\"line\">SqlSessionFactory factory = builder.build(inputStream);</span><br></pre></td></tr></table></figure>\n\n<p>其中， Resources 工具类，这个类在 org.apache.ibatis.io 包中。Resources 类帮助你从类路径下、文件系统或一个 web URL 中加载资源文件。</p>\n<h4 id=\"6-2-SqlSession工厂对象SqlSessionFactory\"><a href=\"#6-2-SqlSession工厂对象SqlSessionFactory\" class=\"headerlink\" title=\"6.2 SqlSession工厂对象SqlSessionFactory\"></a>6.2 SqlSession工厂对象SqlSessionFactory</h4><p>SqlSessionFactory 有多个个方法创建SqlSession 实例。常用的有如下两个：</p>\n<p><img src=\"https://i.loli.net/2019/09/04/MJtzZrpU1Gva6CX.png\" alt class=\"article-img\"></p>\n<h4 id=\"6-3-SqlSession会话对象\"><a href=\"#6-3-SqlSession会话对象\" class=\"headerlink\" title=\"6.3 SqlSession会话对象\"></a>6.3 SqlSession会话对象</h4><p>SqlSession 实例在 MyBatis 中是非常强大的一个类。在这里你会看到所有执行语句、提交或回滚事务和获取映射器实例的方法。</p>\n<p>执行语句的方法主要有：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;T&gt; <span class=\"function\">T <span class=\"title\">selectOne</span><span class=\"params\">(String statement, Object parameter)</span> </span></span><br><span class=\"line\"><span class=\"function\">&lt;E&gt; List&lt;E&gt; <span class=\"title\">selectList</span><span class=\"params\">(String statement, Object parameter)</span> </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">insert</span><span class=\"params\">(String statement, Object parameter)</span> </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">update</span><span class=\"params\">(String statement, Object parameter)</span> </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">delete</span><span class=\"params\">(String statement, Object parameter)</span></span></span><br></pre></td></tr></table></figure>\n\n<p>操作事务的方法主要有：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">commit</span><span class=\"params\">()</span>  </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">rollback</span><span class=\"params\">()</span></span></span><br></pre></td></tr></table></figure>\n\n</package></mapper></mapper></mapper>","prev":{"title":"【Mybatis】动态SQL&核心配置文件","link":"post/【Mybatis】动态SQL-核心配置文件"},"next":{"title":"【SpringMVC】文件上传&拦截器&异常处理","link":"post/【SpringMVC】文件上传-拦截器-异常处理"},"plink":"https://gmahsm.github.io/post/【Mybatis】入门/","reward":true,"copyright":{"custom":"copyright:自由转载-非商用-禁止演绎-保持署名"}}